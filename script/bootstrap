#!/usr/bin/env bash

function bootstrap {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "$shome/script/profile"

  case "${DISTRIB_ID}" in
    Darwin)
      local platform='osx-x64_bin.dmg'
      brew install wget
      ;;
    *)
      local platform='linux-x64_bin.tar.gz'
      ;;
  esac
  
  set -x 
  if [[ ! -f "${DATA}/cache/nodist/${JAVA_VERSION}$platform" ]]; then
    wget -c -O "${DATA}/cache/nodist/${JAVA_VERSION}$platform" --no-check-certificate --no-cookies --header "Cookie: oraclelicense=accept-securebackup-cookie" "${JAVA_URL}${platform}"
  fi

  case "${DISTRIB_ID}" in
    Darwin)
      block compile dmg "${DATA}/cache/nodist/${JAVA_VERSION}$platform" \
        "JDK 9.0.1" \
        "JDK 9.0.1.pkg"
      ;;
    *)
      mkdir -p "$shome/vendor"
      pushd "$shome/vendor"
      tar xfz "${DATA}/cache/nodist/${JAVA_VERSION}$platform"
      popd
      ;;
  esac
}

bootstrap
